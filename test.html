<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ambitus test</title>
</head>
<body>

    <div data-bind="template: { name: 'tpl-' + (interval() === 'day' ? 'week' : interval()), data: data }"></div>

    <script id="tpl-week" type="text/html">
        <table>
            <thead>
                <tr data-bind="foreach: days">
                    <th data-bind="text: $data.format('ddd')"></th>
                </tr>
            </thead>
            <tbody>
                <tr data-bind="foreach: days">
                    <td></td>
                </tr>
            </tbody>
        </table>
    </script>

    <script id="tpl-month" type="text/html">
        <table>
            <thead>
                <tr data-bind="foreach: weeks[0].days">
                    <th data-bind="text: $data.format('ddd')"></th>
                </tr>
            </thead>
            <tbody data-bind="foreach: weeks">
                <tr data-bind="foreach: days">
                    <td data-bind="text: $data.format('Do')"></td>
                </tr>
            </tbody>
        </table>
    </script>

    <script>
require = {
    paths: {
        'moment': 'bower/moment/moment',
        'moment-range': 'bower/moment-range/lib/moment-range'
    },
    deps: [
        'moment'
    ],
    callback: init
};

function init() {
    require([
        'ambitus'
    ], function (Ambitus) {

        var obs = ko.observable(),
            ambitus = new Ambitus({
                onChange: obs
            }),
            viewModel = {
                interval: ko.computed(function () {
                    return obs().interval;
                }),
                data: ko.computed(function () {
                    var range = obs().range,
                        data = {};

                    if (obs().interval === 'month') {
                        data.weeks = [];

                        range.by('week', function (date) {
                            var days = [];
                            data.weeks.push({
                                days: days
                            });
                            console.log(moment().range(date, date.endOf('week')))
                            moment().range(date, date.endOf('week')).by('day', function (date) {
                                console.log(date)
                                days.push(date);
                            })
                        });
                    } else {
                        data.days = [];

                        range.by('day', function (date) {
                            data.days.push(date);
                        });
                    }
console.log(data);
                    return data;
                })
            };

        ko.applyBindings(viewModel);
    });
}
    </script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/knockout/2.2.1/knockout-min.js"></script>
    <script src="bower/requirejs/require.js"></script>
</body>
</html>
