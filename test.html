<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ambitus test</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.2.0/pure-min.css">
    <style>
        body {
            padding: 20px;
        }
    </style>
</head>
<body>

    <button data-bind="click: ambitus.previous.bind(ambitus)">&laquo;</button>
    <button data-bind="click: ambitus.next.bind(ambitus)">&raquo;</button>
    <button data-bind="click: ambitus.today.bind(ambitus)">Today</button>

    <div style="float:right">
        <button data-bind="click: function () { ambitus.interval('day'); }">Day</button>
        <button data-bind="click: function () { ambitus.interval('week'); }">Week</button>
        <button data-bind="click: function () { ambitus.interval('month'); }">Month</button>
    </div>

    <div data-bind="template: { name: 'tpl-' + data().interval, data: data }"></div>

    <script id="tpl-week" type="text/html">
        <table class="pure-table">
            <thead>
                <tr data-bind="foreach: days">
                    <th data-bind="text: $data.format('ddd MMM Do')"></th>
                </tr>
            </thead>
            <tbody>
                <tr data-bind="foreach: days">
                    <td>Day content</td>
                </tr>
            </tbody>
        </table>
    </script>

    <script id="tpl-month" type="text/html">
        <table class="pure-table">
            <thead>
                <tr data-bind="foreach: weeks[0].days">
                    <th data-bind="text: $data.format('dddd')"></th>
                </tr>
            </thead>
            <tbody data-bind="foreach: weeks">
                <tr data-bind="foreach: days">
                    <td data-bind="text: $data.format('MMM Do')"></td>
                </tr>
            </tbody>
        </table>
    </script>

    <script>
require = {
    paths: {
        'moment': 'bower/moment/moment',
        'moment-range': 'bower/moment-range/lib/moment-range'
    },
    deps: [
        'moment'
    ],
    callback: init
};

function init() {
    require([
        'ambitus'
    ], function (Ambitus) {

        var obs = ko.observable(),
            ambitus = new Ambitus({
                interval: 'week',
                onChange: obs
            }),
            viewModel = {
                ambitus: ambitus,
                interval: ko.computed(function () {
                    return obs().interval;
                }),
                data: ko.computed(function () {
                    var range = obs().range,
                        data = {
                            interval: obs().interval
                        };

                    if (data.interval === 'month') {
                        data.weeks = [];

                        range.by('week', function (weekdate) {
                            var days = [],
                                range = moment().range(moment(weekdate).startOf('week'), moment(weekdate).endOf('week'));

                            data.weeks.push({
                                days: days
                            });
                            range.by('day', function (date) {
                                days.push(date);
                            })
                        });
                    } else {
                        data.days = [];

                        range.by('day', function (date) {
                            data.days.push(date);
                        });
                    }

                    if (data.interval === 'day') {
                        data.interval = 'week';
                    }
                    return data;
                })
            };

        ko.applyBindings(viewModel);
    });
}
    </script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/knockout/2.2.1/knockout-min.js"></script>
    <script src="bower/requirejs/require.js"></script>
</body>
</html>
